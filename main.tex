\documentclass[10pt,a4paper]{article}
\usepackage[driver=xetex,a4paper,twoside,left=30mm,right=25mm,top=30mm,bottom=40mm]{geometry} % propper margins on a4 paper
\usepackage{pdfpages} % to include cover
\usepackage{url}
\usepackage[hidelinks]{hyperref} % make contents and references clickable in pdf
\usepackage{multicol} % allows multiple colums
\usepackage{titlesec} % adjust whitespace around headings and improves placing
\usepackage{microtype} % adjusts kerning and letterspacing
\usepackage{soul} %striketrough
\usepackage{parskip} % newline instead of indenting
\usepackage{graphicx} % include images

\usepackage{fontspec} % allows custom fonts
\setmainfont[BoldFont=Source Sans Pro Bold,AutoFakeSlant=0.3]{Source Serif Pro}
\setmonofont{Source Code Pro}

\usepackage{listings} % allows code listings
\usepackage{lstautogobble}

\lstdefinelanguage{CSharp}{language=[sharp]C}

\lstdefinelanguage{FSharp}
    {morekeywords={let, new, match, with, rec, open, module, namespace, type, of, member, and, for, in, do, begin, end, fun, function, try, mutable, if, then, else},
    sensitive=true,
    morecomment=[l][\itshape]{///},
    morecomment=[l][\itshape]{//},
    morecomment=[s][\itshape]{{(*}{*)}},
    morestring=[b]",
    }

\lstdefinelanguage{mc}
    {morekeywords={Func,Data,TypeFunc,Module,TypeAlias,Inherit,is},
     morestring=[b]",
     sensitive=true,
    }

\lstset{basicstyle=\footnotesize\ttfamily,
        breaklines=true,
        keepspaces=true,
        xleftmargin=6pt,
        keywordstyle=\bfseries,
        stringstyle=\itshape,
        %gobble=2, % ignore first 2 spaces indents in code listings
        %frame=single,
        autogobble,
        captionpos=b,
        } % non ASCII-characters won't render properly. Use #\verb|contents|#

\lstnewenvironment{MC}[1][]{% make code unsplittable
   \noindent
   \minipage{\linewidth} 
   \lstset{language=mc,#1}}
   {\endminipage}

\lstnewenvironment{FS}[1][]{% make code unsplittable
   \noindent
   \minipage{\linewidth} 
   \lstset{language=FSharp,#1}}
   {\endminipage}

\lstnewenvironment{CS}[1][]{% make code unsplittable
   \noindent
   \minipage{\linewidth} 
   \lstset{language=[sharp]C,#1}}
   {\endminipage}

\usepackage[sorting=none,backend=biber]{biblatex} %citations
\addbibresource{references.bib}
\renewcommand*{\bibfont}{\small} % small references at the end

\usepackage{draftwatermark}
\SetWatermarkText{DRAFT - DO NOT GRADE}
\SetWatermarkFontSize{40pt}
\SetWatermarkLightness{0.8}
\SetWatermarkAngle{0}
\SetWatermarkVerCenter{5em}

\begin{document}

% disable page numbers
\pagestyle{empty} 

% cover page
\includepdf[pages=1]{cover.pdf}
\newpage

% make subsubsections unnumbered and not show up in the TOC
\setcounter{secnumdepth}{2} 
\setcounter{tocdepth}{2}

% start page numbers
\setcounter{page}{1}
\pagenumbering{arabic}
\pagestyle{plain}

\begin{multicols}{2}
\tableofcontents

\input{intro}
\input{metacasanova}

\section{Research}
As discussed in section~\ref{research_questions}, the main research question is split in subquestions.
Each answer of a subquestion is proven by implementing a part of the backend. 

To illustrate how the different parts of the back-end relate to each other, here is a diagram of the dataflow through the backend.

\includegraphics[width=\columnwidth]{overview}

As you can see, the front-end interface contains the IR and goes through the validator.
From there, depending on the compiler flags, it either goes to the interpreter or the codegen.
In case it goes to the interpreter, the program is directly executed.
In case it goes to the codegen, it is translated to the output language.
To translate all the identifiers, the mangler is needed.
The debugger is optionally embedded in the executable, depending on compiler flags.

\input{language}
\input{interface}
\input{ir}
\input{codegen}
\input{mangler}
\input{interpreter}
\input{debugger}

\input{conclusion}

\printbibliography

% appendix
\setcounter{section}{0}
\renewcommand\thesection{\Alph{section}}

\section{Glossary}
boilerplate code

--- difficult words here ---

\end{multicols}

\renewcommand\thesection{\Alph{section}}
\newpage

\section{Source}
\subsection{Common.fs} 
\lstinputlisting[numbers=left,language=FSharp]{Common.fs}
\subsection{CodegenInterface.fs} 
\lstinputlisting[numbers=left,language=FSharp]{CodegenInterface.fs}
\subsection{Codegen.fs} 
\lstinputlisting[numbers=left,language=FSharp]{Codegen.fs}
\subsection{Balltest.fs} 
\lstinputlisting[numbers=left,language=FSharp]{balltest.fs}
\subsection{Mangle.fs} 
\lstinputlisting[numbers=left,language=FSharp]{Mangle.fs}
\subsection{\_DBUG.cs}
\lstinputlisting[numbers=left,language=CSharp]{_DBUG.cs}

\end{document}
